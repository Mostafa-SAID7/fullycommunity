<article class="post-card">
  <!-- Post Header -->
  <div class="post-header">
    <a [routerLink]="['/profile', post().authorId]" class="author-link">
      <div class="author-avatar">
        @if (post().author.avatarUrl) {
          <img [src]="post().author.avatarUrl" [alt]="post().author.firstName">
        } @else {
          <span>{{ getAuthorInitials() }}</span>
        }
      </div>
      <div class="author-info">
        <span class="author-name">{{ post().author.firstName }} {{ post().author.lastName }}</span>
        <div class="post-meta">
          <span class="post-time">{{ getTimeAgo(post().publishedAt || post().createdAt) }}</span>
          <span class="visibility-icon">
            @if (post().visibility === 'Public') {
              <svg viewBox="0 0 24 24" fill="currentColor" title="Public">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
              </svg>
            } @else if (post().visibility === 'FriendsOnly') {
              <svg viewBox="0 0 24 24" fill="currentColor" title="Friends">
                <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
              </svg>
            } @else {
              <svg viewBox="0 0 24 24" fill="currentColor" title="Private">
                <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
              </svg>
            }
          </span>
        </div>
      </div>
    </a>

    <!-- Post Menu -->
    <div class="post-menu-container">
      <button class="menu-btn" (click)="toggleMenu()">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
        </svg>
      </button>
      @if (showMenu()) {
        <div class="post-menu">
          <button class="menu-item">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg>
            Save post
          </button>
          <button class="menu-item">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
            Hide post
          </button>
          @if (isOwner()) {
            <hr>
            <button class="menu-item" [routerLink]="['/community/post', post().id, 'edit']">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
              Edit post
            </button>
            <button class="menu-item danger" (click)="deletePost()">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
              Delete post
            </button>
          }
        </div>
      }
    </div>
  </div>

  <!-- Post Content -->
  <div class="post-content">
    @if (post().title && post().type !== 'General') {
      <h3 class="post-title">{{ post().title }}</h3>
    }
    <p class="post-text" [innerHTML]="post().content"></p>
  </div>

  <!-- Post Media -->
  @if (post().media && post().media.length > 0) {
    <div class="post-media" [class.grid-2]="post().media.length === 2" [class.grid-3]="post().media.length >= 3">
      @for (media of post().media.slice(0, 4); track media.id) {
        <div class="media-item">
          @if (media.type === 'image') {
            <img [src]="media.url" [alt]="post().title">
          } @else {
            <video [src]="media.url" controls></video>
          }
          @if ($index === 3 && post().media.length > 4) {
            <div class="more-overlay">+{{ post().media.length - 4 }}</div>
          }
        </div>
      }
    </div>
  } @else if (post().coverImageUrl) {
    <div class="post-media">
      <img [src]="post().coverImageUrl" [alt]="post().title">
    </div>
  }

  <!-- Post Stats -->
  <div class="post-stats">
    <div class="stats-left">
      @if (likeCount() > 0) {
        <span class="like-count">
          <span class="like-icon">üëç</span>
          {{ likeCount() }}
        </span>
      }
    </div>
    <div class="stats-right">
      @if (post().commentCount > 0) {
        <button (click)="toggleComments()">{{ post().commentCount }} comments</button>
      }
      @if (post().shareCount > 0) {
        <span>{{ post().shareCount }} shares</span>
      }
    </div>
  </div>

  <!-- Post Actions -->
  <div class="post-actions">
    <button class="action-btn" [class.liked]="isLiked()" (click)="toggleLike()">
      <svg viewBox="0 0 24 24" fill="currentColor">
        @if (isLiked()) {
          <path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"/>
        } @else {
          <path d="M9 21h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.58 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2zM9 9l4.34-4.34L12 10h9v2l-3 7H9V9zM1 9h4v12H1z"/>
        }
      </svg>
      <span>Like</span>
    </button>
    <button class="action-btn" (click)="toggleComments()">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4-.01-18zM18 14H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
      </svg>
      <span>Comment</span>
    </button>
    <button class="action-btn" (click)="sharePost()">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
      </svg>
      <span>Share</span>
    </button>
  </div>

  <!-- Comments Section -->
  @if (showComments()) {
    <div class="comments-section">
      <!-- Comment Input -->
      @if (user()) {
        <div class="comment-input">
          <div class="avatar small">{{ getUserInitials() }}</div>
          <div class="input-wrapper">
            <input 
              type="text" 
              placeholder="Write a comment..."
              [(ngModel)]="newComment"
              (keyup.enter)="submitComment()">
            <button class="send-btn" [disabled]="!newComment().trim()" (click)="submitComment()">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
              </svg>
            </button>
          </div>
        </div>
      }

      <!-- Comments List -->
      @if (loadingComments()) {
        <div class="loading-comments">Loading comments...</div>
      } @else {
        <div class="comments-list">
          @for (comment of comments(); track comment.id) {
            <div class="comment-item">
              <div class="avatar small">
                {{ comment.author.firstName?.charAt(0) }}{{ comment.author.lastName?.charAt(0) }}
              </div>
              <div class="comment-content">
                <div class="comment-bubble">
                  <span class="comment-author">{{ comment.author.firstName }} {{ comment.author.lastName }}</span>
                  <p>{{ comment.content }}</p>
                </div>
                <div class="comment-actions">
                  <button>Like</button>
                  <button>Reply</button>
                  <span>{{ getTimeAgo(comment.createdAt) }}</span>
                </div>
              </div>
            </div>
          }
        </div>
      }
    </div>
  }
</article>
