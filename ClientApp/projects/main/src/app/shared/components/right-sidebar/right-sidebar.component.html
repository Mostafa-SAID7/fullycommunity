<!-- Mobile Toggle Button - Top Right -->
<button (click)="toggleMobileSidebar()"
  class="xl:hidden fixed top-16 end-4 z-50 w-10 h-10 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-full shadow-lg border border-gray-200 dark:border-gray-700 flex items-center justify-center transition-all"
  [attr.aria-label]="isMobileOpen() ? 'Close sidebar' : 'Open contacts'">
  <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
    <path [attr.d]="getIcon(isMobileOpen() ? 'close' : 'contacts')" />
  </svg>
</button>

<!-- Mobile Overlay -->
<div *ngIf="isMobileOpen()" (click)="closeMobileSidebar()"
  class="xl:hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-40">
</div>

<!-- Right Sidebar - Microsoft Fluent Design Style -->
<!-- On xl screens: always visible. On smaller screens: controlled by isMobileOpen() -->
<aside 
  class="fixed top-14 end-0 h-[calc(100vh-56px)] w-72 max-w-[85vw] xl:max-w-none bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm border-s border-gray-200/50 dark:border-gray-700/50 overflow-hidden transition-transform duration-300 shadow-xl xl:shadow-none"
  [style.transform]="sidebarTransform()"
  [style.z-index]="isMobileOpen() ? '45' : (isXlScreen() ? '40' : '30')"
  [attr.aria-hidden]="!isXlScreen() && !isMobileOpen()">

  <!-- Scrollbar Wrapper (Forces scrollbar to left) -->
  <div class="h-full overflow-y-auto scrollbar-left">
    <!-- Content Wrapper (Resets direction for text) -->
    <div class="reset-direction min-h-full">
      <!-- Close button inside sidebar (mobile only) -->
      <button (click)="closeMobileSidebar()"
        class="xl:hidden absolute top-3 end-3 w-8 h-8 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center justify-center text-gray-500 dark:text-gray-400 transition-colors z-50">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
          <path [attr.d]="getIcon('close')" />
        </svg>
      </button>

      <div class="p-4 flex flex-col gap-4">

        <!-- Sponsored / Ads -->
        @if (showSponsored && sponsoredItems.length > 0) {
        <section class="bg-gray-50/50 dark:bg-gray-800/50 rounded-xl p-3">
          <h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3">Sponsored
          </h4>
          @for (item of sponsoredItems; track item.id) {
          <a [href]="item.url"
            class="flex gap-3 no-underline text-gray-900 dark:text-gray-100 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-all group"
            target="_blank" rel="noopener">
            <div class="w-24 h-24 rounded-lg bg-gray-200 dark:bg-gray-700 overflow-hidden flex-shrink-0">
              <img [src]="item.image" [alt]="item.title"
                class="w-full h-full object-cover group-hover:scale-105 transition-transform"
                onerror="this.style.display='none'">
            </div>
            <div class="flex-1 min-w-0">
              <p class="m-0 font-medium text-sm text-gray-900 dark:text-white line-clamp-2">{{ item.title }}</p>
              <span class="text-xs text-gray-500 dark:text-gray-400 truncate block mt-1">{{ item.url }}</span>
            </div>
          </a>
          }
        </section>
        }

        <!-- Upcoming Events -->
        @if (showEvents && events.length > 0) {
        <section class="bg-gray-50/50 dark:bg-gray-800/50 rounded-xl p-3">
          <h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3">Upcoming
            Events
          </h4>
          <div class="flex flex-col gap-2">
            @for (event of events; track event.id) {
            <div
              class="flex gap-3 items-center p-2.5 bg-white dark:bg-gray-900 rounded-lg border border-gray-200/50 dark:border-gray-700/50 hover:border-primary-300 dark:hover:border-primary-700 transition-all cursor-pointer group">
              <div
                class="w-10 h-10 rounded-lg bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="currentColor">
                  <path
                    d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z" />
                </svg>
              </div>
              <div class="flex-1 min-w-0">
                <p
                  class="m-0 font-medium text-sm text-gray-900 dark:text-white truncate group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors">
                  {{ event.title }}</p>
                <span class="text-xs text-gray-500 dark:text-gray-400">{{ event.time }}</span>
              </div>
              <svg class="w-4 h-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"
                viewBox="0 0 24 24" fill="currentColor">
                <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
              </svg>
            </div>
            }
          </div>
        </section>
        }

        <!-- Online Contacts -->
        @if (showContacts && contacts.length > 0) {
        <section class="bg-gray-50/50 dark:bg-gray-800/50 rounded-xl p-3">
          <div class="flex justify-between items-center mb-3">
            <h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider m-0">Contacts
            </h4>
            <div class="flex gap-1">
              <button
                class="w-7 h-7 rounded-lg flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
                title="Search">
                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" viewBox="0 0 24 24" fill="currentColor">
                  <path
                    d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
                </svg>
              </button>
              <button
                class="w-7 h-7 rounded-lg flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
                title="Options">
                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" viewBox="0 0 24 24" fill="currentColor">
                  <path
                    d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" />
                </svg>
              </button>
            </div>
          </div>
          <div class="flex flex-col gap-1">
            @for (contact of contacts; track contact.id) {
            <a href="#"
              class="flex items-center gap-3 p-2 rounded-lg no-underline text-gray-900 dark:text-gray-100 hover:bg-white dark:hover:bg-gray-900 transition-all group">
              <div class="relative flex-shrink-0">
                <div
                  class="w-9 h-9 rounded-full bg-gradient-to-br from-primary-500 to-primary-600 text-white flex items-center justify-center font-semibold text-xs overflow-hidden">
                  @if (contact.avatar) {
                  <img [src]="contact.avatar" [alt]="contact.name" class="w-full h-full object-cover">
                  } @else {
                  <span>{{ contact.initials }}</span>
                  }
                </div>
                @if (contact.online) {
                <span
                  class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-gray-50 dark:border-gray-800 rounded-full"></span>
                }
              </div>
              <span
                class="font-medium text-sm truncate group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors">{{
                contact.name }}</span>
            </a>
            }
          </div>
        </section>
        }

        <!-- Footer Links -->
        <div class="mt-auto pt-4 border-t border-gray-200/50 dark:border-gray-700/50">
          <div class="flex flex-wrap gap-x-2 gap-y-1 text-xs text-gray-500 dark:text-gray-400">
            <a href="#" class="hover:text-primary-500 transition-colors">Privacy</a>
            <span>·</span>
            <a href="#" class="hover:text-primary-500 transition-colors">Terms</a>
            <span>·</span>
            <a href="#" class="hover:text-primary-500 transition-colors">Advertising</a>
            <span>·</span>
            <a href="#" class="hover:text-primary-500 transition-colors">Cookies</a>
            <span>·</span>
            <a href="#" class="hover:text-primary-500 transition-colors">More</a>
          </div>
          <p class="mt-2 text-xs text-gray-400 dark:text-gray-500">© {{ getCurrentYear() }} CommunityCar</p>
        </div>
      </div>
    </div>
  </div>
</aside>
""