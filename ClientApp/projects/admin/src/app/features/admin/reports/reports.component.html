<div class="reports-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>Reports & Analytics</h1>
      <p>Platform performance metrics and insights</p>
    </div>
    <div class="header-actions">
      <app-refresh-button (refresh)="refreshReports()" [loading]="loading()" [variant]="'secondary'" [size]="'md'"
        [showText]="false" [title]="'Refresh reports data'">
      </app-refresh-button>

      <label class="sr-only" for="periodSelect">Period</label>
      <select id="periodSelect" [(ngModel)]="selectedPeriod" (change)="onPeriodChange()"
        aria-label="Select report period" class="period-select">
        <option value="day">Today</option>
        <option value="week">This Week</option>
        <option value="month">This Month</option>
        <option value="quarter">This Quarter</option>
        <option value="year">This Year</option>
      </select>

      <div class="export-buttons">
        <button (click)="exportReport('users', 'csv')" aria-label="Export users report" title="Export users report"
          class="export-btn users-btn">
          Users CSV
        </button>
        <button (click)="exportReport('content', 'xlsx')" aria-label="Export content report"
          title="Export content report" class="export-btn content-btn">
          Content Excel
        </button>
        <button (click)="exportReport('engagement', 'pdf')" aria-label="Export engagement report"
          title="Export engagement report" class="export-btn primary-btn">
          <svg class="export-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          Export PDF
        </button>
      </div>
    </div>
  </div>

  <!-- Error / Loading -->
  <div *ngIf="error()" role="alert" class="error-alert">
    {{ error() }}
  </div>

  <!-- Realtime Stats Banner -->
  <div *ngIf="realtimeStats() as rt" class="realtime-banner" role="region" aria-label="Realtime statistics">
    <div class="realtime-grid">
      <div class="realtime-item">
        <div class="status-dot" aria-hidden="true"></div>
        <div class="realtime-content">
          <div class="label">Active Now</div>
          <div class="value">{{ rt.activeUsers }}</div>
        </div>
      </div>
      <div class="realtime-item">
        <div class="realtime-content">
          <div class="label">Today's Posts</div>
          <div class="value">{{ rt.todayPosts }}</div>
        </div>
      </div>
      <div class="realtime-item">
        <div class="realtime-content">
          <div class="label">Today's Reviews</div>
          <div class="value">{{ rt.todayReviews }}</div>
        </div>
      </div>
      <div class="realtime-item">
        <div class="realtime-content">
          <div class="label">Today's Questions</div>
          <div class="value">{{ rt.todayQuestions || 0 }}</div>
        </div>
      </div>
      <div class="realtime-item">
        <div class="realtime-content">
          <div class="label">Today's Guides</div>
          <div class="value">{{ rt.todayGuides || 0 }}</div>
        </div>
      </div>
      <div class="realtime-item">
        <div class="realtime-content">
          <div class="label">Server Load</div>
          <div class="value">{{ rt.serverLoad || 0 }}%</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Overview Cards -->
  <div *ngIf="overview()" class="overview-stats-grid">
    <app-stat-card *ngFor="let card of overviewStatCards" [config]="card">
    </app-stat-card>
  </div>

  <!-- Platform Summary -->
  <section *ngIf="summary() as sum" class="platform-summary" aria-label="Platform summary">
    <h3>Platform Summary</h3>
    <div class="summary-grid">
      <div class="summary-item blue">
        <div class="icon">üë§</div>
        <div class="value">{{ sum.users.total | number }}</div>
        <div class="label">+{{ sum.users.newThisMonth }} this month</div>
      </div>
      <div class="summary-item green">
        <div class="icon">üìù</div>
        <div class="value">{{ sum.content.posts | number }}</div>
        <div class="label">Posts</div>
      </div>
      <div class="summary-item yellow">
        <div class="icon">‚≠ê</div>
        <div class="value">{{ sum.content.reviews | number }}</div>
        <div class="label">Reviews</div>
      </div>
      <div class="summary-item purple">
        <div class="icon">üìö</div>
        <div class="value">{{ sum.content.guides | number }}</div>
        <div class="label">Guides</div>
      </div>
      <div class="summary-item pink">
        <div class="icon">‚ùì</div>
        <div class="value">{{ sum.content.questions | number }}</div>
        <div class="label">Questions</div>
      </div>
      <div class="summary-item indigo">
        <div class="icon">üëÅÔ∏è</div>
        <div class="value">{{ sum.engagement.totalViews | number }}</div>
        <div class="label">Total Views</div>
      </div>
    </div>
  </section>

  <!-- Loading skeleton -->
  <div *ngIf="loading()" class="loading-skeleton">
    <div class="skeleton-item title"></div>
    <div class="skeleton-item chart"></div>
  </div>

  <!-- Enhanced Charts Section -->
  <div *ngIf="!loading()" class="charts-grid">
    <!-- User Growth Chart -->
    <div class="chart-card">
      <div class="chart-header">
        <div class="chart-info">
          <h3>User Growth Trends</h3>
          <p>New user registrations over time</p>
        </div>
        <div class="chart-legend">
          <div class="legend-item">
            <span class="legend-dot blue"></span>
            <span class="legend-label">New Users</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot green"></span>
            <span class="legend-label">Active Users</span>
          </div>
        </div>
      </div>
      <app-bar-chart [config]="getUserGrowthChartConfig()" class="w-full">
      </app-bar-chart>
    </div>

    <!-- Content Distribution Pie Chart -->
    <div class="chart-card">
      <div class="chart-header">
        <div class="chart-info">
          <h3>Content Distribution</h3>
          <p>Content types breakdown</p>
        </div>
      </div>
      <app-pie-chart [config]="getContentDistributionConfig()" class="w-full">
      </app-pie-chart>
    </div>
  </div>

  <!-- Content Engagement Analytics -->
  <div *ngIf="!loading()" class="chart-card">
    <div class="chart-header">
      <div class="chart-info">
        <h3>Content Engagement Analytics</h3>
        <p>Views, likes, and comments over time</p>
      </div>
      <div class="chart-legend">
        <div class="legend-item">
          <span class="legend-dot purple"></span>
          <span class="legend-label">Views</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot pink"></span>
          <span class="legend-label">Likes</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot blue"></span>
          <span class="legend-label">Comments</span>
        </div>
      </div>
    </div>
    <app-line-chart [config]="getEngagementChartConfig()" class="w-full">
    </app-line-chart>
  </div>

  <!-- Enhanced Top Content Section -->
  <div *ngIf="!loading()" class="content-card top-content-section">
    <div class="card-header">
      <div class="header-text">
        <h3 class="card-title">Top Performing Content</h3>
        <p class="card-subtitle">Most engaging content across all platforms</p>
      </div>
      <div class="header-filters">
        <label class="sr-only" for="contentType">Filter content type</label>
        <select id="contentType" [(ngModel)]="contentType" (change)="loadTopContent()" class="filter-select">
          <option value="">All Types</option>
          <option value="post">Posts</option>
          <option value="review">Reviews</option>
          <option value="guide">Guides</option>
        </select>
        <button class="view-all-btn">
          View All
        </button>
      </div>
    </div>

    <div *ngIf="topContent().length > 0; else noTopContent" class="top-content-list">
      <div *ngFor="let item of topContent(); trackBy: trackByTitle; let i = index" role="listitem" tabindex="0"
        (keydown)="onKeyActivate($event, item)" (click)="openTopContent(item)" class="content-item">
        <div class="item-rank">
          <div class="rank-badge">
            #{{ i + 1 }}
          </div>
        </div>
        <div class="item-details">
          <div class="item-main-info">
            <h4 class="item-title">{{ item.title }}</h4>
            <span class="item-type-badge" [ngClass]="item.type">{{ item.type }}</span>
          </div>
          <div class="item-metrics">
            <div class="metric">
              <i class="fas fa-eye metric-icon"></i>
              <span class="metric-value">{{ item.views | number }}</span>
              <span class="metric-label">views</span>
            </div>
            <div class="metric">
              <i class="fas fa-chart-line metric-icon"></i>
              <span class="metric-value" [class.high-engagement]="item.engagement > 10">{{ item.engagement }}%</span>
              <span class="metric-label">engagement</span>
            </div>
          </div>
        </div>
        <div class="item-arrow">
          <i class="fas fa-chevron-right"></i>
        </div>
      </div>
    </div>

    <ng-template #noTopContent>
      <div class="empty-state">
        <div class="empty-icon-wrapper">
          <i class="fas fa-inbox empty-icon"></i>
        </div>
        <h4 class="empty-title">No Content Data Available</h4>
        <p class="empty-description">
          There is no content data available for the selected period. Try adjusting your filters or check back later.
        </p>
      </div>
    </ng-template>
  </div>

  <!-- Enhanced Analytics Tabs -->
  <div class="analytics-section">
    <!-- Tab Navigation -->
    <app-tab-navigation [tabs]="analyticsTabItems" [activeTabId]="activeAnalyticsTab"
      (tabChange)="onAnalyticsTabChange($event)">
    </app-tab-navigation>

    <!-- Overview Tab (Default) -->
    <div *ngIf="activeAnalyticsTab === 'overview'" class="tab-content overview-tab">
      <div class="tab-placeholder">
        <h3 class="placeholder-title">Analytics Overview</h3>
        <p class="placeholder-text">Select a specific analytics tab above to view detailed insights</p>
      </div>
    </div>

    <!-- User Growth Trends Tab -->
    <div *ngIf="activeAnalyticsTab === 'user-growth' && detailedUserGrowth()" class="tab-content user-growth-tab">
      <!-- User Growth Chart -->
      <div class="content-card">
        <div class="card-header">
          <div class="header-text">
            <h3 class="card-title">Detailed User Growth Trends</h3>
            <p class="card-subtitle">New users, active users, and retention metrics over time</p>
          </div>
        </div>
        <app-line-chart [config]="getDetailedUserGrowthConfig()" class="chart-full-width">
        </app-line-chart>
      </div>

      <!-- User Demographics -->
      <div *ngIf="detailedUserGrowth()?.demographics" class="demographics-grid">
        <!-- Age Groups -->
        <div class="content-card">
          <h4 class="card-subtitle-lg">Age Distribution</h4>
          <div class="age-distribution-list">
            <div *ngFor="let age of detailedUserGrowth()!.demographics.ageGroups" class="age-item">
              <span class="age-range">{{ age.range }}</span>
              <div class="age-bar-wrapper">
                <div class="age-bar-track">
                  <div class="age-bar-fill" [style.width.%]="age.percentage"></div>
                </div>
                <span class="age-percentage">{{ age.percentage }}%</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Acquisition Channels -->
        <div class="content-card">
          <h4 class="card-subtitle-lg">Acquisition Channels</h4>
          <app-pie-chart [config]="getAcquisitionChannelsConfig()" class="chart-full-width">
          </app-pie-chart>
        </div>
      </div>

      <!-- Retention Metrics -->
      <div *ngIf="detailedUserGrowth()?.retentionMetrics" class="content-card retention-card">
        <h4 class="card-subtitle-lg">User Retention Metrics</h4>
        <div class="retention-grid">
          <div class="retention-item">
            <div class="retention-value" [ngClass]="getRetentionColor(detailedUserGrowth()!.retentionMetrics.day1)">
              {{ detailedUserGrowth()!.retentionMetrics.day1 }}%
            </div>
            <div class="retention-label">Day 1 Retention</div>
          </div>
          <div class="retention-item">
            <div class="retention-value" [ngClass]="getRetentionColor(detailedUserGrowth()!.retentionMetrics.day7)">
              {{ detailedUserGrowth()!.retentionMetrics.day7 }}%
            </div>
            <div class="retention-label">Day 7 Retention</div>
          </div>
          <div class="retention-item">
            <div class="retention-value" [ngClass]="getRetentionColor(detailedUserGrowth()!.retentionMetrics.day30)">
              {{ detailedUserGrowth()!.retentionMetrics.day30 }}%
            </div>
            <div class="retention-label">Day 30 Retention</div>
          </div>
          <div class="retention-item">
            <div class="retention-value" [ngClass]="getRetentionColor(detailedUserGrowth()!.retentionMetrics.day90)">
              {{ detailedUserGrowth()!.retentionMetrics.day90 }}%
            </div>
            <div class="retention-label">Day 90 Retention</div>
          </div>
        </div>
      </div>

      <!-- Growth Prediction -->
      <div *ngIf="detailedUserGrowth()?.growthPrediction" class="content-card prediction-card">
        <h4 class="card-subtitle-lg">Growth Predictions</h4>
        <div class="prediction-grid">
          <div class="prediction-item blue-theme">
            <div class="prediction-value">
              {{ formatNumber(detailedUserGrowth()!.growthPrediction.nextMonth) }}
            </div>
            <div class="prediction-label">Predicted Next Month</div>
          </div>
          <div class="prediction-item green-theme">
            <div class="prediction-value">
              {{ formatNumber(detailedUserGrowth()!.growthPrediction.nextQuarter) }}
            </div>
            <div class="prediction-label">Predicted Next Quarter</div>
          </div>
          <div class="prediction-item purple-theme">
            <div class="prediction-value">
              {{ detailedUserGrowth()!.growthPrediction.confidence }}%
            </div>
            <div class="prediction-label">Confidence Level</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Content Engagement Analytics Tab -->
    <div *ngIf="activeAnalyticsTab === 'content-engagement' && detailedContentEngagement()"
      class="tab-content engagement-tab">
      <!-- Enhanced Engagement Chart -->
      <div class="content-card">
        <div class="card-header">
          <div class="header-text">
            <h3 class="card-title">Enhanced Content Engagement Analytics</h3>
            <p class="card-subtitle">Comprehensive engagement metrics including saves and advanced analytics</p>
          </div>
        </div>
        <app-line-chart [config]="getEnhancedEngagementConfig()" class="chart-full-width">
        </app-line-chart>
      </div>

      <!-- Content Type Performance -->
      <div class="content-card">
        <h4 class="card-subtitle-lg">Content Type Performance</h4>
        <app-bar-chart [config]="getContentTypePerformanceConfig()" class="chart-full-width">
        </app-bar-chart>
      </div>

      <!-- Engagement Trends -->
      <div *ngIf="detailedContentEngagement()?.engagementTrends" class="content-card">
        <h4 class="card-subtitle-lg">Engagement Trends</h4>
        <div class="trends-grid">
          <div *ngFor="let trend of detailedContentEngagement()!.engagementTrends" class="trend-item">
            <div class="trend-header">
              <span class="trend-metric-name">{{ trend.metric }}</span>
              <span class="trend-icon">{{ getGrowthTrendIcon(trend.trend) }}</span>
            </div>
            <div class="trend-stats">
              <span class="trend-value" [ngClass]="trend.trend">
                {{ trend.percentage > 0 ? '+' : '' }}{{ trend.percentage }}%
              </span>
            </div>
            <p class="trend-description">{{ trend.description }}</p>
          </div>
        </div>
      </div>

      <!-- Audience Insights -->
      <div *ngIf="detailedContentEngagement()?.audienceInsights" class="content-card">
        <h4 class="card-subtitle-lg">Audience Insights</h4>
        <div class="insights-list">
          <div *ngFor="let insight of detailedContentEngagement()!.audienceInsights" class="insight-item">
            <div class="insight-header">
              <h5 class="insight-segment">{{ insight.segment }}</h5>
              <div class="insight-metrics">
                <span class="insight-size">{{ formatNumber(insight.size) }} users</span>
                <span class="insight-rate">{{ insight.engagementRate }}% engagement</span>
              </div>
            </div>
            <div class="insight-details">
              <span class="detail-label">Peak Activity: </span>
              <span class="detail-value">{{ insight.peakActivity }}</span>
            </div>
            <div class="insight-preferences">
              <span class="detail-label">Preferred Content: </span>
              <div class="preference-tags">
                <span *ngFor="let content of insight.preferredContent" class="preference-tag">
                  {{ content }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Localization Tab -->
    <div *ngIf="activeAnalyticsTab === 'localization'" class="tab-content localization-tab">
      <div class="content-card">
        <div class="card-header">
          <div class="header-text">
            <h3 class="card-title">Localization Management</h3>
            <p class="card-subtitle">Manage languages, translations, and multilingual content</p>
          </div>
          <a routerLink="/admin/localization" class="action-btn primary">
            <i class="fas fa-globe"></i>
            Manage Localization
          </a>
        </div>

        <div class="localization-promo">
          <div class="promo-icon-wrapper">
            <i class="fas fa-language promo-icon"></i>
          </div>
          <h4 class="promo-title">Multilingual Content Management</h4>
          <p class="promo-description">
            Manage translations, add new languages, and monitor localization progress across your platform.
          </p>
          <div class="promo-features">
            <div class="feature-item blue-theme">
              <div class="feature-icon">üåç</div>
              <div class="feature-title">Multi-Language Support</div>
              <div class="feature-subtitle">Add and manage multiple languages</div>
            </div>
            <div class="feature-item green-theme">
              <div class="feature-icon">üìù</div>
              <div class="feature-title">Translation Management</div>
              <div class="feature-subtitle">Edit and update translations</div>
            </div>
            <div class="feature-item purple-theme">
              <div class="feature-icon">üìä</div>
              <div class="feature-title">Progress Tracking</div>
              <div class="feature-subtitle">Monitor translation completion</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>