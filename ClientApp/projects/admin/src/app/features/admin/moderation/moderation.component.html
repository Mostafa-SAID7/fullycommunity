<div class="moderation">
  <div class="page-header">
    <div class="header-info">
      <h1>Content Moderation</h1>
      <p>Review and moderate reported content</p>
    </div>
    <button class="btn-refresh" (click)="loadItems(); loadStats()">ðŸ”„ Refresh</button>
  </div>

  <!-- Stats -->
  <div class="stats-grid" *ngIf="stats()">
    <div class="stat-card" [class.urgent]="stats()!.pendingReports > 0">
      <div class="stat-value" [class.urgent]="stats()!.pendingReports > 0">{{ stats()!.pendingReports }}</div>
      <div class="stat-label">Pending Reports</div>
    </div>
    <div class="stat-card">
      <div class="stat-value success">{{ stats()!.resolvedToday }}</div>
      <div class="stat-label">Resolved Today</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ stats()!.resolvedThisWeek }}</div>
      <div class="stat-label">Resolved This Week</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ stats()!.totalReports }}</div>
      <div class="stat-label">Total Reports</div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn" [class.active]="activeTab === 'pending'" (click)="setTab('pending')">
      Pending
      <span *ngIf="stats()?.pendingReports" class="badge">{{ stats()!.pendingReports }}</span>
    </button>
    <button class="tab-btn" [class.active]="activeTab === 'resolved'" (click)="setTab('resolved')">
      Resolved
    </button>
    <button class="tab-btn" [class.active]="activeTab === 'all'" (click)="setTab('all')">
      All Reports
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading()" class="loading-container">
    <div class="spinner"></div>
  </div>

  <!-- Moderation Queue -->
  <div *ngIf="!loading()" class="moderation-queue">
    <div *ngFor="let item of items()" class="queue-item" 
         [class.high-priority]="isHighPriority(item)"
         [ngClass]="getPriorityClass(item)">
      <div class="queue-item-header">
        <div class="report-info">
          <span class="priority-badge" *ngIf="item.priority !== 'normal'">{{ item.priority | uppercase }}</span>
          <span class="type-badge" [ngClass]="getReasonClass(item.reportReason)">
            {{ item.reportReason }}
          </span>
          <span class="content-type">{{ item.contentType }}</span>
        </div>
        <div class="report-meta">
          <span class="status-badge" [class]="'status-' + item.status">{{ item.status }}</span>
          <span class="report-time">{{ item.reportedAt | date:'short' }}</span>
        </div>
      </div>

      <div class="queue-item-body">
        <div class="content-preview">
          <h3>{{ item.contentTitle }}</h3>
          <p class="content-id">ID: {{ item.contentId }}</p>
        </div>

        <div class="report-details">
          <div class="detail-row">
            <span class="detail-label">Reported by:</span>
            <span class="detail-value">{{ item.reportedBy }}</span>
          </div>
          <div class="detail-row" *ngIf="item.moderatorNotes">
            <span class="detail-label">Notes:</span>
            <span class="detail-value">{{ item.moderatorNotes }}</span>
          </div>
        </div>
      </div>

      <div class="queue-item-actions" *ngIf="item.status === 'pending'">
        <button class="action-btn approve" (click)="quickApprove(item)" title="Content is OK">
          âœ“ Approve
        </button>
        <button class="action-btn reject" (click)="quickReject(item)" title="Remove content">
          âœ• Remove
        </button>
        <button class="action-btn dismiss" (click)="openActionModal(item, 'dismiss')" title="Dismiss report">
          Dismiss
        </button>
        <button class="action-btn details" (click)="openActionModal(item, 'reject')" title="More options">
          â‹¯ More
        </button>
      </div>

      <div class="queue-item-resolved" *ngIf="item.status !== 'pending'">
        <span class="resolved-status">{{ item.status | titlecase }}</span>
        <span class="resolved-date" *ngIf="item.moderatedAt">{{ item.moderatedAt | date:'short' }}</span>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="items().length === 0" class="empty-state">
      <div class="empty-icon">âœ…</div>
      <h3>{{ activeTab === 'pending' ? 'All Clear!' : 'No Reports' }}</h3>
      <p>{{ activeTab === 'pending' ? 'No pending reports to review' : 'No reports found' }}</p>
    </div>
  </div>

  <!-- Action Modal -->
  <div class="modal-overlay" *ngIf="showActionModal()" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ actionType() | titlecase }} Report</h2>
        <button class="close-btn" (click)="closeModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="item-summary" *ngIf="selectedItem()">
          <p><strong>Content:</strong> {{ selectedItem()!.contentTitle }}</p>
          <p><strong>Type:</strong> {{ selectedItem()!.contentType }}</p>
          <p><strong>Reason:</strong> {{ selectedItem()!.reportReason }}</p>
        </div>
        <div class="form-group">
          <label>Notes / Reason</label>
          <textarea [(ngModel)]="actionNotes" rows="3" placeholder="Add notes about this action..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeModal()">Cancel</button>
        <button class="btn-confirm" [class]="'btn-' + actionType()" (click)="confirmAction()">
          Confirm {{ actionType() | titlecase }}
        </button>
      </div>
    </div>
  </div>
</div>
