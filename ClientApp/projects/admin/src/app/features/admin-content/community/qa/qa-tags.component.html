<div class="min-h-screen bg-gray-50 p-4 md:p-6 lg:p-8">
  <!-- Header -->
  <div class="mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div>
      <h1 class="text-2xl md:text-3xl font-bold text-gray-900">Tag Management</h1>
      <p class="text-sm md:text-base text-gray-600 mt-1">Manage, merge, and standardize tags</p>
    </div>
    
    @if (selectedTags().length > 0) {
      <div class="flex gap-2">
        <button
          (click)="openMergeModal()"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm"
        >
          Merge {{ selectedTags().length }} Tags
        </button>
        <button
          (click)="clearSelection()"
          class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm"
        >
          Clear Selection
        </button>
      </div>
    }
  </div>

  <!-- Selection Info -->
  @if (selectedTags().length > 0) {
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
      <div class="flex items-center justify-between">
        <div>
          <span class="text-sm font-medium text-blue-900">{{ selectedTags().length }} tags selected</span>
          <div class="flex flex-wrap gap-2 mt-2">
            @for (tag of selectedTags(); track tag) {
              <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">{{ tag }}</span>
            }
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Tags List -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    @if (loading()) {
      <div class="p-8 text-center">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        <p class="mt-2 text-gray-600">Loading tags...</p>
      </div>
    } @else if (tags().length === 0) {
      <div class="p-8 text-center text-gray-500">
        <p>No tags found</p>
      </div>
    } @else {
      <!-- Desktop Table -->
      <div class="hidden md:block overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left">
                <input
                  type="checkbox"
                  class="rounded border-gray-300"
                  [checked]="selectedTags().length === tags().length"
                  (change)="selectedTags().length === tags().length ? clearSelection() : selectAllTags()"
                />
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tag</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Usage Count</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Used</th>
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            @for (tag of tags(); track tag.tag) {
              <tr [class.bg-blue-50]="isTagSelected(tag.tag)" class="hover:bg-gray-50">
                <td class="px-6 py-4 whitespace-nowrap">
                  <input
                    type="checkbox"
                    class="rounded border-gray-300"
                    [checked]="isTagSelected(tag.tag)"
                    (change)="toggleTagSelection(tag.tag)"
                  />
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">{{ tag.tag }}</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  {{ tag.count }} questions
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  {{ formatDate(tag.lastUsed) }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                  <button
                    (click)="deleteTag(tag.tag)"
                    [disabled]="actionLoading()"
                    class="text-red-600 hover:text-red-900 disabled:opacity-50"
                    title="Delete tag"
                  >
                    Delete
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Mobile Cards -->
      <div class="md:hidden divide-y divide-gray-200">
        @for (tag of tags(); track tag.tag) {
          <div class="p-4" [class.bg-blue-50]="isTagSelected(tag.tag)">
            <div class="flex items-start gap-3">
              <input
                type="checkbox"
                class="mt-1 rounded border-gray-300"
                [checked]="isTagSelected(tag.tag)"
                (change)="toggleTagSelection(tag.tag)"
              />
              <div class="flex-1">
                <span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">{{ tag.tag }}</span>
                <div class="mt-2 text-sm text-gray-600">
                  <div>{{ tag.count }} questions</div>
                  <div>Last used: {{ formatDate(tag.lastUsed) }}</div>
                </div>
                <button
                  (click)="deleteTag(tag.tag)"
                  [disabled]="actionLoading()"
                  class="mt-2 text-sm text-red-600 hover:text-red-900 disabled:opacity-50"
                >
                  Delete
                </button>
              </div>
            </div>
          </div>
        }
      </div>

      <!-- Pagination -->
      @if (totalPages() > 1) {
        <div class="px-4 py-3 bg-gray-50 border-t border-gray-200">
          <div class="flex flex-col sm:flex-row items-center justify-between gap-3">
            <div class="text-sm text-gray-700">
              Showing page {{ currentPage() }} of {{ totalPages() }} ({{ totalCount() }} total tags)
            </div>
            <div class="flex gap-2">
              <button
                (click)="goToPage(currentPage() - 1)"
                [disabled]="currentPage() === 1"
                class="px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100"
              >
                Previous
              </button>
              <button
                (click)="goToPage(currentPage() + 1)"
                [disabled]="currentPage() === totalPages()"
                class="px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100"
              >
                Next
              </button>
            </div>
          </div>
        </div>
      }
    }
  </div>
</div>

<!-- Merge Tags Modal -->
@if (showMergeModal()) {
  <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-lg max-w-md w-full p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Merge Tags</h3>
      
      <div class="mb-4">
        <p class="text-sm text-gray-600 mb-2">Merging {{ selectedTags().length }} tags:</p>
        <div class="flex flex-wrap gap-2 p-3 bg-gray-50 rounded-lg max-h-32 overflow-y-auto">
          @for (tag of selectedTags(); track tag) {
            <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">{{ tag }}</span>
          }
        </div>
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Target Tag Name
        </label>
        <input
          type="text"
          [(ngModel)]="targetTag"
          placeholder="Enter the tag name to merge into..."
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        />
        <p class="text-xs text-gray-500 mt-1">
          All selected tags will be renamed to this tag
        </p>
      </div>

      <div class="flex gap-3">
        <button
          (click)="closeMergeModal()"
          [disabled]="actionLoading()"
          class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50"
        >
          Cancel
        </button>
        <button
          (click)="confirmMergeTags()"
          [disabled]="!targetTag().trim() || actionLoading()"
          class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"
        >
          @if (actionLoading()) {
            <span>Merging...</span>
          } @else {
            <span>Merge Tags</span>
          }
        </button>
      </div>
    </div>
  </div>
}
