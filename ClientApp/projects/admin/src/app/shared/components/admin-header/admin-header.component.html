<header class="admin-header">
  <!-- Left Section -->
  <div class="header-left">
    <!-- Sidebar Toggle Button -->
    <button (click)="toggleSidebar.emit()" class="sidebar-toggle-btn" type="button" aria-label="Toggle sidebar">
      <i class="fas fa-bars toggle-icon"></i>
    </button>

    <!-- Logo and Brand -->
    <div class="header-brand">
      <app-logo-button routerLink="/admin/dashboard" brandName="" subtitle="" [showText]="false"
        size="sm">
      </app-logo-button>
    </div>
  </div>

  <!-- Center Section -->
  <div class="header-center">
    <!-- Search Bar -->
    <div class="header-search">
      <div class="search-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input type="text" placeholder="Search..." class="search-input" [(ngModel)]="searchQuery"
          (keyup.enter)="performSearch()">
        <button *ngIf="searchQuery" (click)="clearSearch()" class="search-clear" type="button">
          <i class="fas fa-times clear-icon"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Right Section -->
  <div class="header-right">
    <!-- Quick Actions -->
    <div class="header-actions">
      <!-- Refresh Button -->
      <!-- Refresh button already handles its own icon, assuming generic refresh content or passed via projected content? No, it's a component. Check if it uses icons internally. -->
      <app-refresh-button (refresh)="refreshData()" [loading]="isRefreshing" [variant]="'ghost'" [size]="'md'"
        [showText]="false" [title]="'Refresh Dashboard Data'">
      </app-refresh-button>

      <!-- Role Switcher (Super Admin Only) -->
      <div *ngIf="isSuperAdmin()" class="role-switcher">
        <button (click)="toggleRoleSwitcher()" class="action-btn role-button">
          <span class="role-icon">{{ getCurrentRoleDisplay().icon }}</span>
          <i class="fas fa-chevron-down dropdown-icon" [class.rotated]="showRoleSwitcher()"></i>
        </button>
        <div *ngIf="showRoleSwitcher()" class="role-dropdown">
          <div class="dropdown-header">Switch Admin View</div>
          <div class="dropdown-content">
            <button *ngFor="let role of adminRoles; trackBy: trackByRoleId" (click)="switchRole(role)"
              class="role-option" [class.active]="currentViewRole() === role.id">
              <span class="role-option-icon">{{ role.icon }}</span>
              <div class="role-option-content">
                <div class="role-option-name">{{ role.displayName }}</div>
                <div class="role-option-description">{{ role.description }}</div>
              </div>
              <i *ngIf="currentViewRole() === role.id" class="fas fa-check check-icon"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Notifications -->
      <div class="notifications">
        <button class="action-btn notification-btn" [class.has-notifications]="notificationCount > 0"
          (click)="toggleNotifications()" type="button" [title]="'Notifications (' + notificationCount + ')'">
          <i class="fas fa-bell action-icon"></i>
          <span *ngIf="notificationCount > 0" class="notification-badge">
            {{ notificationCount > 99 ? '99+' : notificationCount }}
          </span>
        </button>
        <div *ngIf="showNotifications()" class="notification-dropdown">
          <div class="notification-header">
            <span class="header-title">Notifications</span>
            <div class="header-actions">
              <button *ngIf="notificationService.notifications().length > 0" (click)="markAllAsRead()"
                class="header-action">Mark all read</button>
              <button (click)="createTestNotification()" class="header-action">+ Test</button>
            </div>
          </div>
          <div class="notification-content">
            <div *ngIf="notificationService.loading()" class="loading-state">
              <div class="loading-spinner"></div>
            </div>
            <div *ngIf="!notificationService.loading() && notificationService.notifications().length === 0"
              class="empty-state">
              <i class="fas fa-bell-slash empty-icon"></i>
              <p class="empty-text">No notifications yet</p>
            </div>
            <div *ngIf="!notificationService.loading() && notificationService.notifications().length > 0"
              class="notification-list">
              <div *ngFor="let notification of notificationService.notifications(); trackBy: trackByNotificationId"
                (click)="markAsRead(notification)" class="notification-item" [class.unread]="!notification.isRead">
                <span class="notification-item-icon">{{ notificationService.getNotificationIcon(notification.type)
                  }}</span>
                <div class="notification-item-content">
                  <p class="notification-title">{{ notification.title }}</p>
                  <p *ngIf="notification.message" class="notification-message">{{ notification.message }}</p>
                  <span class="notification-time">{{ notificationService.getTimeAgo(notification.createdAt) }}</span>
                </div>
                <button (click)="deleteNotification($event, notification.id)" class="notification-delete">
                  <i class="fas fa-times delete-icon"></i>
                </button>
              </div>
            </div>
          </div>
          <div *ngIf="notificationService.notifications().length > 0" class="notification-footer">
            <button (click)="clearAllNotifications()" class="clear-all-button">Clear all notifications</button>
          </div>
        </div>
      </div>

      <!-- Language Switcher -->
      <button (click)="languageService.toggleLanguage()" class="action-btn" type="button"
        [title]="languageService.getLanguageLabel()">
        <span class="language-code">{{ languageService.getLanguageIcon() }}</span>
      </button>

      <!-- Theme Switcher -->
      <app-theme-switcher></app-theme-switcher>

      <!-- Settings -->
      <button class="action-btn" routerLink="/admin/settings" type="button" title="Settings">
        <i class="fas fa-cog action-icon"></i>
      </button>
    </div>

    <!-- User Profile -->
    <div class="header-profile">
      <button (click)="toggleProfileMenu()" class="profile-btn" type="button"
        [attr.aria-expanded]="showUserMenu() ? 'true' : 'false'">
        <img *ngIf="currentUser()?.avatarUrl" [src]="currentUser()?.avatarUrl" alt="Avatar" class="profile-avatar">
        <div *ngIf="!currentUser()?.avatarUrl" class="profile-avatar placeholder">{{ getUserInitials() }}</div>
        <div class="profile-info">
          <span class="profile-name">{{ userName }}</span>
          <span class="profile-role">{{ userRole }}</span>
        </div>
        <i class="fas fa-chevron-down profile-arrow"></i>
      </button>
      <div *ngIf="showUserMenu()" class="user-dropdown">
        <div class="user-dropdown-header">
          <div class="dropdown-user-name">{{ userName }}</div>
          <div class="dropdown-user-role">{{ userRole }}</div>
        </div>
        <div class="user-dropdown-content">
          <a routerLink="profile" class="dropdown-link" (click)="toggleProfileMenu()">
            <i class="fas fa-user-circle dropdown-link-icon"></i>
            <span>My Profile</span>
          </a>
          <button (click)="logout()" class="logout-button">
            <i class="fas fa-sign-out-alt logout-icon"></i>
            <span>Logout</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Content Projection for Additional Actions -->
    <ng-content></ng-content>
  </div>
</header>